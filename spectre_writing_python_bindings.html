<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.8.13"/>
    <style>
        /*!
         * IE10 viewport hack for Surface/desktop Windows 8 bug
         * Copyright 2014-2015 Twitter, Inc.
         * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
         */
        @-webkit-viewport { width: device-width; }
        @-moz-viewport    { width: device-width; }
        @-ms-viewport     { width: device-width; }
        @-o-viewport      { width: device-width; }
        @viewport         { width: device-width; }
      </style>
  <title>SpECTRE: Writing Python Bindings</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js", "color.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } }
});
MathJax.Hub.Config({
    tex2jax: {inlineMath: [['^^','^^'], ['\\(', '\\)']]}
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="bootstrap.min.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="popper.min.js"></script>
  <script type="text/javascript" src="bootstrap.min.js"></script>
  <script type="text/javascript" src="spectre.js"></script>
  </head>
  <body>
  <div id="top" class="navbar-fixed-top"><!-- do not remove this div, it is closed by doxygen! -->
  <!-- BEGIN TITLEAREA -->
  <div id="titlearea">
  <script type="text/javascript">
  var searchBox = new SearchBox("searchBox", "search",false,'Search');
  </script>
  <div id="main-nav">
    <ul class="sm sm-dox" id="main-menu">
      <li>
      <a href="index.html">
      SpECTRE &#160;
        <span id="projectnumber">v0.0.0</span>
      </a>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-book"></i><span>Documentation</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 135px;">
            <a href="index.html">
            <i class="octicon octicon-book"></i><span>Introduction</span></a>
          </li>
          <li style="min-width: 135px;">
            <a href="installation.html">
              <i class="octicon octicon-desktop-download"></i><span>Installation</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="tutorials.html">
              <i class="octicon octicon-mortar-board"></i><span>User Tutorials</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="dev_guide.html">
              <i class="octicon octicon-gist-secret"></i><span>Dev Guide</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="code_of_conduct.html">
              <i class="octicon octicon-comment-discussion"></i><span>Code of Conduct</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="contributing_to_spectre.html">
              <i class="octicon octicon-git-pull-request"></i><span>Contributing Guide</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-code"></i>
              <span>Code Reference</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 130px;">
            <a href="modules.html">
              <i class="octicon octicon-code"></i>
              <span>Topics</span>
            </a>
          </li>
          <li style="min-width: 130px;">
            <a href="namespaces.html">
              <i class="octicon octicon-gist"></i>
              <span>Namespaces</span>
            </a>
          </li>
        </ul>
      </li>
      <li>
        <a href="files.html">
          <i class="octicon octicon-file-directory"></i><span>Files</span>
        </a>
      </li>
      <li>
        <a href="citelist.html">
          <i class="octicon octicon-file-text"></i><span>Bibliography</span>
        </a>
      </li>
      <li>
        <a href="https://github.com/sxs-collaboration/spectre" target="_blank">
          <i class="octicon octicon-mark-github"></i><span>View on GitHub</span>
        </a>
      </li>
      <!--The Search <li> is added by doxygen later-->
    </ul>
  </div><!-- main-nav -->
  </div><!-- titlearea -->
  <!-- window showing the filter options -->
  <div id="MSearchSelectWindow"  style="position: fixed;"
       onmouseover="return searchBox.OnSearchSelectShow()"
       onmouseout="return searchBox.OnSearchSelectHide()"
       onkeydown="return searchBox.OnSearchSelectKey(event)">
  </div>
  <!-- iframe showing the search results (closed by default) -->
  <div id="MSearchResultsWindow"  style="position: fixed;">
  <iframe src="javascript:void(0)" frameborder="0"
          name="MSearchResults" id="MSearchResults">
  </iframe>
  </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Writing Python Bindings </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>CMake and Directory Layout</h2>
<p>To allow users to analyze output from simulations and take advantage of SpECTRE's data structures and functions in python, bindings must sometimes be written. SpECTRE uses <a href="https://www.boost.org/doc/libs/1_68_0/libs/python/doc/html/index.html">Boost.Python</a> to aid with generating the bindings. The C++ code for the bindings should generally go in a <code>Python</code> subdirectory. For example, the bindings for the DataStructures library would go in <code>src/DataStructures/Python/</code>. SpECTRE provides the <code>spectre_python_add_module</code> CMake function to make adding a new python module, be it with or without bindings, easy. The python bindings are built only if <code>-D BUILD_PYTHON_BINDINGS=ON</code> is passed when invoking cmake.</p>
<p>The function <code>spectre_python_add_module</code> takes as its first argument the module, in our case <code>DataStructures</code>. The bindings library will be prefixed with <code>Py</code>, and therefore be called <code>PyDataStructures</code>. Optionally, a list of <code>SOURCES</code> can be passed to the CMake function. If the python module will only consist of python files, then the <code>SOURCES</code> option should not be specified. Python files that should be part of the module can be passed with the keyword <code>PYTHON_FILES</code>, e.g. <code>PYTHON_FILES Hello.py HelloWorld.py</code>. Finally, the <code>MODULE_PATH</code> named argument can be passed with a string that is the path to where the module should be. For example, <code>MODULE_PATH "submodule0/submodule1/"</code> would mean the module is accessed from python using <code>import spectre.submodule0.submodule1.MODULE_NAME</code>.</p>
<p>Here is a complete example of how to call the <code>spectre_python_add_module</code> function:</p>
<div class="fragment"><div class="line">spectre_python_add_module(</div><div class="line">  ExtraDataStructures</div><div class="line">  MODULE_PATH &quot;DataStructures/&quot;</div><div class="line">  SOURCES Bindings.cpp MyCoolDataStructure.cpp</div><div class="line">  PYTHON_FILES CoolPythonDataStructure.py</div><div class="line">  )</div></div><!-- fragment --><p>The library that is added has the name <code>PyExtraDataStructures</code> and requires that at least the <code>${SPECTRE_LINK_PYBINDINGS}</code> be set as the last entry to the <code>target_link_libraries</code> call. For example,</p>
<div class="fragment"><div class="line">target_link_libraries(</div><div class="line">  PyExtraDataStructures</div><div class="line">  PUBLIC ExtraDataStructures</div><div class="line">  ${SPECTRE_LINK_PYBINDINGS}</div><div class="line">  )</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd><code>${SPECTRE_LINK_PYBINDINGS}</code> must be the <em>last</em> argument to <code>target_link_libraries</code>.</dd></dl>
<h2>Writing Bindings</h2>
<p>Once a python module has been added you can write the actual bindings. You should structure your bindings directory to reflect the structure of the library you're writing bindings for. For example, say we want bindings for <code><a class="el" href="classDataVector.html" title="Stores a collection of function values. ">DataVector</a></code> and <code><a class="el" href="classMatrix.html" title="A dynamically sized matrix of doubles with column-major storage. ">Matrix</a></code> then we should have one source file for each class's bindings inside <code>src/DataStructures/Python</code>. The functions that generate the bindings should be in the <code><a class="el" href="namespacepy__bindings.html" title="A namespace containing functions for binding Python wrappers to their respective c++ classes and func...">py_bindings</a></code> namespace and have a reasonable name such as <code>bind_datavector</code>. There should be a file named <code>Bindings.cpp</code> which calls all the <code>bind_*</code> functions. The <code>Bindings.cpp</code> file is quite simple and should <code>include &lt;boost/python.hpp&gt;</code>, forward declare the <code>bind_*</code> functions, and then have <code>BOOST_PYTHON_MODULE</code> function. For example,</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/python.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacepy__bindings.html">py_bindings</a> {</div><div class="line"><span class="keywordtype">void</span> bind_datavector();</div><div class="line">}  <span class="comment">// namespace py_bindings</span></div><div class="line"></div><div class="line">BOOST_PYTHON_MODULE(_DataStructures) {</div><div class="line">  Py_Initialize();</div><div class="line">  py_bindings::bind_datavector();</div><div class="line">}</div></div><!-- fragment --><p>Note that the library name is passed to <code>BOOST_PYTHON_MODULE</code> and is prefixed with an underscore. The underscore is important!</p>
<p>The <code><a class="el" href="classDataVector.html" title="Stores a collection of function values. ">DataVector</a></code> bindings serve as an example with code comments on how to write bindings for a class. There is also extensive documentation available directly from <a href="https://www.boost.org/doc/libs/1_68_0/libs/python/doc/html/index.html">Boost.Python</a> and <a href="https://github.com/TNG/boost-python-examples">this GitHub repository</a> also has many helpful examples. SpECTRE currently aims to support both Python 2.7 and Python 3 and as such all bindings must support both.</p>
<dl class="section note"><dt>Note</dt><dd>Exceptions should be allowed to propagate through the bindings so that error handling via exceptions is possible from python rather than having the python interpreter being killed with a call to <code>abort</code>.</dd></dl>
<h2>Testing Python Bindings and Code</h2>
<p>All the python bindings must be tested. SpECTRE uses the <a href="https://docs.python.org/3/library/unittest.html">unittest</a> framework provided as part of python. To register a test file with CMake use the SpECTRE-provided function <code>spectre_add_python_test</code> passing as the first argument the test name (e.g. <code>"Unit.DataStructures.Python.DataVector"</code>), the file as the second argument (e.g. <code>Test_DataVector.py</code>), and a semicolon separated list of labels as the last (e.g. <code>"unit;datastructures;python"</code>). All the test cases should be in a single class so that the python unit testing framework will run all test functions on a single invocation to avoid startup cost.</p>
<p>Below is an example of registering a python test file</p>
<div class="fragment"><div class="line">spectre_add_python_test(</div><div class="line">  &quot;Unit.DataStructures.Python.DataVector&quot;</div><div class="line">  Test_DataVector.py</div><div class="line">  &quot;unit;datastructures;python&quot;)</div></div><!-- fragment --><h2>Using The Bindings</h2>
<p>See <a class="el" href="spectre_using_python.html">Using SpECTRE's Python</a></p>
<h2>Notes:</h2>
<ul>
<li>All python libraries are dynamic/shared libraries.</li>
<li>Exceptions should be allowed to propagate through the bindings so that error handling via exceptions is possible from python rather than having the python interpreter being killed with a call to <code>abort</code>. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; Copyright 2017 - 2019
<a href="https://black-holes.org">SXS Collaboration</a>,
<a href="LICENSE.txt" target="_blank">
<span class="hidden-xs">Distributed under the</span>
MIT License</a>
</small></address>
</body>
</html>
