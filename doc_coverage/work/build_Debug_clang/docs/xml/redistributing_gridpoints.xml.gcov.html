<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - b1f4fe8326c5dc9de3d64954e9325e08a2677cfd - /work/build_Debug_clang/docs/xml/redistributing_gridpoints.xml</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title"> SpECTRE Documentation Coverage Report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">work/build_Debug_clang/docs/xml</a> - redistributing_gridpoints.xml</td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
             <td class="headerItem">Commit:</td>
             <td class="headerValue"><a target="_blank" href="https://github.com/sxs-collaboration/spectre/commit/b1f4fe8326c5dc9de3d64954e9325e08a2677cfd">b1f4fe8326c5dc9de3d64954e9325e08a2677cfd</a></td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2019-10-20 17:39:50</td>
            <td></td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<span class="lineNum">       1 </span><span class="lineCov">          1 : &lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;</span>
<span class="lineNum">       2 </span>            : &lt;doxygen xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;compound.xsd&quot; version=&quot;1.8.13&quot;&gt;
<span class="lineNum">       3 </span>            :   &lt;compounddef id=&quot;redistributing_gridpoints&quot; kind=&quot;page&quot;&gt;
<span class="lineNum">       4 </span>            :     &lt;compoundname&gt;redistributing_gridpoints&lt;/compoundname&gt;
<span class="lineNum">       5 </span>            :     &lt;title&gt;Redistributing Gridpoints&lt;/title&gt;
<span class="lineNum">       6 </span>            :     &lt;detaileddescription&gt;
<span class="lineNum">       7 </span>            : &lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Introduction&lt;/heading&gt;
<span class="lineNum">       8 </span>            : &lt;/para&gt;&lt;para&gt;The simplest way to construct a volume map from two parameterized surfaces is by linearly interpolating between them:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1511&quot;&gt;\[\vec{x}(\xi,\eta,\zeta) = \frac{1-\zeta}{2}\vec{\sigma}_-(\xi,\eta)+ \frac{1+\zeta}{2}\vec{\sigma}_+(\xi,\eta)\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;In the above example, each surface &lt;formula id=&quot;1512&quot;&gt;$\vec{\sigma}_+$&lt;/formula&gt; and &lt;formula id=&quot;1513&quot;&gt;$\vec{\sigma}_-$&lt;/formula&gt; is parameterized using the logical coordinates &lt;formula id=&quot;278&quot;&gt;$\xi$&lt;/formula&gt; and &lt;formula id=&quot;297&quot;&gt;$\eta$&lt;/formula&gt;, and a third coordinate &lt;formula id=&quot;1514&quot;&gt;$\zeta\in[-1,1]$&lt;/formula&gt; is used to interpolate between them.&lt;/para&gt;&lt;para&gt;We then distribute gridpoints on this volume by specifying values of the coordinates &lt;formula id=&quot;478&quot;&gt;$\xi,\eta,$&lt;/formula&gt; and &lt;formula id=&quot;253&quot;&gt;$\zeta$&lt;/formula&gt; at which the gridpoints are located. In SpECTRE these values are the locations of the quadrature nodes. The distribution of the gridpoints throughout the volume depends on the parameterization used, and the simplest choice of parameterization does not necessarily lead to the best gridpoint distribution. In this section we discuss situations in which there exist better parameterizations than those obtained by linear interpolation.&lt;/para&gt;&lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Generalized Logical Coordinates&lt;/heading&gt;
<span class="lineNum">       9 </span>            : &lt;/para&gt;&lt;para&gt;In each of the following examples, we will obtain functions &lt;formula id=&quot;1515&quot;&gt;$\Xi(\xi), \mathrm{H}(\eta),$&lt;/formula&gt; and &lt;formula id=&quot;1516&quot;&gt;$\mathrm{Z}(\zeta)$&lt;/formula&gt; that give better gridpoint distributions than using the logical coordinates alone. Where possible, we will write the reparameterized map such that the functional form of the map is unchanged when replacing &lt;formula id=&quot;298&quot;&gt;$\Xi$&lt;/formula&gt; with &lt;formula id=&quot;278&quot;&gt;$\xi$&lt;/formula&gt;, etc. We therefore refer to &lt;formula id=&quot;1517&quot;&gt;$\Xi, \mathrm{H},$&lt;/formula&gt; and &lt;formula id=&quot;267&quot;&gt;$\mathrm{Z}$&lt;/formula&gt; as the &lt;emphasis&gt;generalized logical coordinates&lt;/emphasis&gt;, as they can also refer to the logical coordinates &lt;formula id=&quot;1518&quot;&gt;$\xi, \eta,$&lt;/formula&gt; and &lt;formula id=&quot;253&quot;&gt;$\zeta$&lt;/formula&gt; themselves, when the transformation is the identity.&lt;/para&gt;&lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Equiangular Maps&lt;/heading&gt;
<span class="lineNum">      10 </span>            : &lt;/para&gt;&lt;para&gt;The mapping for a cubed sphere surface can be easily obtained by taking points that lie on each face of a cube and normalizing them such that they lie on the sphere:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1519&quot;&gt;\[\vec{\sigma}_{+z}(\xi,\eta) = \frac{1}{\sqrt{1 + \xi^2 + \eta^2}} \begin{bmatrix} \xi\\ \eta\\ 1\\ \end{bmatrix}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;In the above example the parameterization used for the upper &lt;formula id=&quot;236&quot;&gt;$+z$&lt;/formula&gt; surface of the cube is linear in &lt;formula id=&quot;278&quot;&gt;$\xi$&lt;/formula&gt; and &lt;formula id=&quot;297&quot;&gt;$\eta$&lt;/formula&gt;. However, distances measured on the surface of the sphere are not linear in &lt;formula id=&quot;278&quot;&gt;$\xi$&lt;/formula&gt; and &lt;formula id=&quot;297&quot;&gt;$\eta$&lt;/formula&gt;. To see this, one may compute &lt;formula id=&quot;1520&quot;&gt;$g_{\xi\xi} = |\frac{\partial\vec{x}}{\partial\xi}|^2$&lt;/formula&gt; to see how distances are measured in terms of &lt;formula id=&quot;278&quot;&gt;$\xi$&lt;/formula&gt;:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1521&quot;&gt;\[g_{\xi,\xi}|_{\eta=0} = \frac{1}{(1+\xi^2)^2}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;This metric term demonstrates that a gridpoint distribution uniform in &lt;formula id=&quot;278&quot;&gt;$\xi$&lt;/formula&gt; will end up being compressed near &lt;formula id=&quot;1522&quot;&gt;$\xi=\pm1$&lt;/formula&gt;. Suppose we reparameterized the surface using the generalized logical coordinate &lt;formula id=&quot;1523&quot;&gt;$\Xi\in[-1,1]$&lt;/formula&gt;. We would find:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1524&quot;&gt;\[g_{\xi,\xi}|_{\eta=0} = \frac{\Xi&amp;apos;^2}{(1+\Xi^2)^2}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;Ideally, we would like distances measured along a curvilinear surface to be linear in the logical coordinates. We solve the differential equation and obtain:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1525&quot;&gt;\[\Xi = \tan(\xi\pi/4)\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;These two parameterizations of the cubed sphere are known as the &lt;emphasis&gt;equidistant&lt;/emphasis&gt; and &lt;emphasis&gt;equiangular&lt;/emphasis&gt; central projections of the cube onto the sphere. We now summarize their usage in SpECTRE CoordinateMaps that have &lt;computeroutput&gt;with_equiangular_map&lt;/computeroutput&gt; as a specifiable parameter:&lt;/para&gt;&lt;para&gt;In the case where &lt;computeroutput&gt;with_equiangular_map&lt;/computeroutput&gt; is &lt;computeroutput&gt;true&lt;/computeroutput&gt;, we have the equiangular coordinates&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;226&quot;&gt;\[\textrm{equiangular xi} : \Xi(\xi) = \textrm{tan}(\xi\pi/4)\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;227&quot;&gt;\[\textrm{equiangular eta} : \mathrm{H}(\eta) = \textrm{tan}(\eta\pi/4)\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;with derivatives&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;228&quot;&gt;\[\Xi&amp;apos;(\xi) = \frac{\pi}{4}(1+\Xi^2)\]&lt;/formula&gt;,&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;229&quot;&gt;\[\mathrm{H}&amp;apos;(\eta) = \frac{\pi}{4}(1+\mathrm{H}^2)\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;In the case where &lt;computeroutput&gt;with_equiangular_map&lt;/computeroutput&gt; is &lt;computeroutput&gt;false&lt;/computeroutput&gt;, we have the equidistant coordinates&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;230&quot;&gt;\[ \textrm{equidistant xi} : \Xi = \xi\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;231&quot;&gt;\[ \textrm{equidistant eta} : \mathrm{H} = \eta\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;with derivatives:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1526&quot;&gt;\[\Xi&amp;apos;(\xi) = 1\]&lt;/formula&gt; &lt;formula id=&quot;1527&quot;&gt;\[\mathrm{H}&amp;apos;(\eta) = 1\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;&lt;heading level=&quot;2&quot;&gt;Projective Maps&lt;/heading&gt;
<span class="lineNum">      11 </span>            : &lt;/para&gt;&lt;para&gt;The mapping for any convex quadrilateral can be obtained by bilinearly interpolating between each vertex &lt;formula id=&quot;1528&quot;&gt;$\vec{x}_1, \vec{x}_2, \vec{x}_3$&lt;/formula&gt; and &lt;formula id=&quot;1529&quot;&gt;$\vec{x}_4$&lt;/formula&gt;:&lt;/para&gt;&lt;para&gt;&lt;formula id=&quot;1530&quot;&gt;\[\vec{x}(\xi,\eta) = \frac{(1-\xi)(1-\eta)}{4}\vec{x}_1+ \frac{(1+\xi)(1-\eta)}{4}\vec{x}_2+ \frac{(1-\xi)(1+\eta)}{4}\vec{x}_3+ \frac{(1+\xi)(1+\eta)}{4}\vec{x}_4 \]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;In the case of a trapezoid where two of the sides are parallel, it is appropriate to linearly interpolate along the parallel sides. However, linearly interpolating between the two bases results in a less than ideal gridpoint distribution. This happens in the case of SpECTRE&amp;apos;s Frustum, where the logical coordinate &lt;formula id=&quot;253&quot;&gt;$\zeta$&lt;/formula&gt; interpolates between the bases.&lt;/para&gt;&lt;para&gt;&lt;image type=&quot;html&quot; name=&quot;BilinearVProjective.png&quot;&gt;Comparison of mappings. (Noah Veltman)&lt;/image&gt;
<span class="lineNum">      12 </span>            :  As seen in Veltman&amp;apos;s &lt;ulink url=&quot;https://bl.ocks.org/veltman/8f5a157276b1dc18ce2fba1bc06dfb48&quot;&gt;Warp-Off&lt;/ulink&gt;, linear interpolation between the two bases results in a uniformly spaced grid between the bases of the frustum. This causes elements near the smaller base to be longer in the direction normal to the base, and elements near the larger base to be shorter in the direction normal to the base. We desire elements that have roughly equal sizes along each of their dimensions.&lt;/para&gt;&lt;para&gt;We can redistribute the gridpoints in the &lt;formula id=&quot;253&quot;&gt;$\zeta$&lt;/formula&gt; direction using a projective map, moving more gridpoints toward the smaller base. We can also see in the figure above that a projective map can be applied incorrectly, leaving elements distorted at the opposite end. From this we can see that it is important to control the degree of projection.&lt;/para&gt;&lt;para&gt;We adapt a technique from projective geometry to obtain the desired grid spacing. The heart of the method lies in the fact that objects arranged in a line at equal distances from one another will appear to converge as they approach the horizon.&lt;/para&gt;&lt;para&gt;&lt;image type=&quot;html&quot; name=&quot;ProjectionOntoPlane.png&quot;&gt;Controlling the degree of projection.&lt;/image&gt;
<span class="lineNum">      13 </span>            :  The above diagram demonstrates how to obtain a nonlinearly parameterized object (seen in red) from a linearly parameterized one (seen in purple). This is done by lifting the linearly parameterized object into a higher spatial dimension &lt;formula id=&quot;615&quot;&gt;$w$&lt;/formula&gt;, such that its projection onto the plane remains unchanged. As seen above, &lt;formula id=&quot;303&quot;&gt;$w_{\delta}$&lt;/formula&gt; controls the degree of projection of one end of the object (purple) into a higher spatial dimension &lt;formula id=&quot;615&quot;&gt;$w$&lt;/formula&gt;. In projective geometry, these points that exist in the higher dimension are labeled with &lt;emphasis&gt;homogeneous coordinates&lt;/emphasis&gt; &lt;formula id=&quot;1531&quot;&gt;$\tilde{x}, \tilde{y}, \tilde{z}, w$&lt;/formula&gt;, to distinguish them from the Cartesian coordinates that label points that exist on the &lt;formula id=&quot;304&quot;&gt;$w=1$&lt;/formula&gt; hyperplane, &lt;formula id=&quot;1532&quot;&gt;$x,y,z$&lt;/formula&gt;. The resulting grid (seen in red) is obtained by projecting back into the &lt;formula id=&quot;304&quot;&gt;$w=1$&lt;/formula&gt; hyperplane. The Cartesian coordinates are obtained by dividing each homogeneous coordinate of the linearly parameterized object by its respective &lt;formula id=&quot;615&quot;&gt;$w$&lt;/formula&gt; coordinate value.&lt;/para&gt;&lt;para&gt;The parametric equation for the purple object seen above in homogeneous coordinates is: &lt;formula id=&quot;1533&quot;&gt;\[\begin{bmatrix}\tilde{x}\\\tilde{y}\\\tilde{z}\\w\\\end{bmatrix}= \frac{1-\zeta}{2}\begin{bmatrix}x_1\\y_1\\z_1\\1\\\end{bmatrix}+ \frac{1+\zeta}{2}\begin{bmatrix}x_2w_{\delta}\\y_2w_{\delta}\\ z_2w_{\delta}\\w_{\delta}\\\end{bmatrix}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;The equation for the projected red object in Cartesian coordinates is obtained by dividing by w: &lt;formula id=&quot;1534&quot;&gt;\[\vec{x}(\zeta) = \frac{1}{w(\zeta)} \begin{bmatrix} \tilde{x}(\zeta)\\ \tilde{y}(\zeta)\\ \tilde{z}(\zeta)\\ \end{bmatrix}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;We wish to cast our parametric equation for the surface into the form: &lt;formula id=&quot;1535&quot;&gt;\[\vec{x}(\zeta) = \frac{1-\mathrm{Z}}{2}\vec{x}_1 + \frac{1+\mathrm{Z}}{2}\vec{x}_2\]&lt;/formula&gt; for some appropriate choice of auxiliary variable &lt;computeroutput&gt;projective_zeta&lt;/computeroutput&gt; &lt;formula id=&quot;1536&quot;&gt;$ = \mathrm{Z}(\zeta)$&lt;/formula&gt;. We would also like for &lt;formula id=&quot;267&quot;&gt;$\mathrm{Z}$&lt;/formula&gt; to reduce to &lt;formula id=&quot;253&quot;&gt;$\zeta$&lt;/formula&gt; when &lt;formula id=&quot;1537&quot;&gt;$w_{\delta}\ = 1$&lt;/formula&gt;.&lt;/para&gt;&lt;para&gt;Defining the auxiliary variables &lt;formula id=&quot;1538&quot;&gt;$w_{\pm} := w_{\delta}\pm 1$&lt;/formula&gt;, the desired &lt;formula id=&quot;1516&quot;&gt;$\mathrm{Z}(\zeta)$&lt;/formula&gt; is given by: &lt;formula id=&quot;1539&quot;&gt;\[\mathrm{Z} = \frac{w_- + \zeta w_+} {w_+ + \zeta w_-}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;with derivative: &lt;formula id=&quot;1540&quot;&gt;\[\mathrm{Z}&amp;apos; = \frac{\partial\mathrm{Z}}{\partial \zeta} = \frac{w_+^2 - w_-^2}{(w_+ + \zeta w_-)^2}\]&lt;/formula&gt;&lt;/para&gt;&lt;para&gt;For SpECTRE CoordinateMaps that have &lt;computeroutput&gt;projective_scale_factor&lt;/computeroutput&gt; as a specifiable parameter, the value &lt;formula id=&quot;1541&quot;&gt;$w_{\delta} = 1$&lt;/formula&gt; should be supplied in case the user does not want to use projective scaling. If &lt;computeroutput&gt;auto_projective_scale_factor&lt;/computeroutput&gt; is set to &lt;computeroutput&gt;true&lt;/computeroutput&gt;, the map will compute a value of &lt;formula id=&quot;303&quot;&gt;$w_{\delta}$&lt;/formula&gt; that is appropriate. &lt;/para&gt;    &lt;/detaileddescription&gt;
<span class="lineNum">      14 </span>            :   &lt;/compounddef&gt;
<span class="lineNum">      15 </span>            : &lt;/doxygen&gt;
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
